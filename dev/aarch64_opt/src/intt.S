/* Copyright (c) 2022 Arm Limited
 * Copyright (c) 2022 Hanno Becker
 * Copyright (c) 2023 Amin Abdulrahman, Matthias Kannwischer
 * Copyright (c) The mlkem-native project authors
 * SPDX-License-Identifier: Apache-2.0 OR ISC OR MIT
 */

/* References
 * ==========
 *
 * - [NeonNTT]
 *   Neon NTT: Faster Dilithium, Kyber, and Saber on Cortex-A72 and Apple M1
 *   Becker, Hwang, Kannwischer, Yang, Yang
 *   https://eprint.iacr.org/2021/986
 *
 * - [SLOTHY_Paper]
 *   Fast and Clean: Auditable high-performance assembly via constraint solving
 *   Abdulrahman, Becker, Kannwischer, Klein
 *   https://eprint.iacr.org/2022/1303
 */

/*yaml
  Name: intt_asm
  Description: AArch64 ML-KEM inverse NTT following @[NeonNTT] and @[SLOTHY_Paper]
  Signature: void mlk_intt_asm(int16_t p[256], const int16_t twiddles12345[80], const int16_t twiddles56[384])
  ABI:
    x0:
      type: buffer
      size_bytes: 512
      permissions: read/write
      c_parameter: int16_t p[256]
      description: Input/output polynomial
    x1:
      type: buffer
      size_bytes: 160
      permissions: read-only
      c_parameter: const int16_t twiddles12345[80]
      description: Twiddle factors for layers 1-5
    x2:
      type: buffer
      size_bytes: 768
      permissions: read-only
      c_parameter: const int16_t twiddles56[384]
      description: Twiddle factors for layers 6-7
  Stack:
    bytes: 64
    description: saving callee-saved Neon registers
*/

#include "../../../common.h"
#if defined(MLK_ARITH_BACKEND_AARCH64) &&  !defined(MLK_CONFIG_MULTILEVEL_NO_SHARED)
/* simpasm: header-end */

// Bounds:
// If C is chosen so that |src| < q * C, then |dst| < q * (0.0508 * C + 1/2)

// See mlken/reduce.c and test/test_bounds.py for more details.

.macro push_pair reg1, reg2, offset
    stp \reg1, \reg2, [sp, #\offset]
    .cfi_rel_offset \reg1, \offset
    .cfi_rel_offset \reg2, (\offset + 8)
.endm

.macro restore_pair reg1, reg2, offset
    ldp \reg1, \reg2, [sp, #\offset]
    .cfi_restore \reg1
    .cfi_restore \reg2
.endm

.macro alloc_stack size
    sub sp, sp, #\size
    .cfi_adjust_cfa_offset \size
.endm

.macro free_stack size
    add sp, sp, #\size
    .cfi_adjust_cfa_offset -\size
.endm

.macro mulmodq dst, src, const, idx0, idx1
        // Signed barrett multiplication @[NeonNTT, Section 3.1.2] using
        // round-to-nearest-even-integer approximation. Following loc.cit.,
        // this is functionally the same as a signed Montgomery multiplication
        // with a suitable constant of absolute value < q.
        sqrdmulh t2.8h,      \src\().8h, \const\().h[\idx1\()]
        mul      \dst\().8h, \src\().8h, \const\().h[\idx0\()]
        mls      \dst\().8h, t2.8h,      consts.h[0]
.endm

.macro mulmod dst, src, const, const_twisted
        sqrdmulh t2.8h,      \src\().8h, \const_twisted\().8h
        mul      \dst\().8h, \src\().8h, \const\().8h
        mls      \dst\().8h, t2.8h,      consts.h[0]
.endm

.macro gs_butterfly a, b, root, idx0, idx1
        sub tmp.8h,   \a\().8h, \b\().8h
        add \a\().8h, \a\().8h, \b\().8h
        mulmodq  \b, tmp, \root, \idx0, \idx1
.endm

.macro gs_butterfly_v a, b, root, root_twisted
        sub tmp.8h,   \a\().8h, \b\().8h
        add \a\().8h, \a\().8h, \b\().8h
        mulmod  \b, tmp, \root, \root_twisted
.endm

.macro mul_ninv dst0, dst1, dst2, dst3, src0, src1, src2, src3
        mulmod \dst0, \src0, ninv, ninv_tw
        mulmod \dst1, \src1, ninv, ninv_tw
        mulmod \dst2, \src2, ninv, ninv_tw
        mulmod \dst3, \src3, ninv, ninv_tw
.endm

.macro barrett_reduce a
        sqdmulh t0.8h,    \a\().8h, consts.h[1]
        srshr   t0.8h,    t0.8h,    #11
        mls     \a\().8h, t0.8h,    consts.h[0]
.endm

.macro load_roots_123
        ldr q_root0, [r12345_ptr], #32
        ldr q_root1, [r12345_ptr, #-16]
.endm

.macro load_next_roots_45
        ldr q_root0, [r12345_ptr], #16
.endm

.macro load_next_roots_67
        ldr q_root0,    [r67_ptr], #(6*16)
        ldr q_root0_tw, [r67_ptr, #(-6*16 + 1*16)]
        ldr q_root1,    [r67_ptr, #(-6*16 + 2*16)]
        ldr q_root1_tw, [r67_ptr, #(-6*16 + 3*16)]
        ldr q_root2,    [r67_ptr, #(-6*16 + 4*16)]
        ldr q_root2_tw, [r67_ptr, #(-6*16 + 5*16)]
.endm

.macro transpose4 data
        trn1 t0.4s, \data\()0.4s, \data\()1.4s
        trn2 t1.4s, \data\()0.4s, \data\()1.4s
        trn1 t2.4s, \data\()2.4s, \data\()3.4s
        trn2 t3.4s, \data\()2.4s, \data\()3.4s

        trn2 \data\()2.2d, t0.2d, t2.2d
        trn2 \data\()3.2d, t1.2d, t3.2d
        trn1 \data\()0.2d, t0.2d, t2.2d
        trn1 \data\()1.2d, t1.2d, t3.2d
.endm

.macro transpose_single data_out, data_in
        trn1 \data_out\()0.4s, \data_in\()0.4s, \data_in\()1.4s
        trn2 \data_out\()1.4s, \data_in\()0.4s, \data_in\()1.4s
        trn1 \data_out\()2.4s, \data_in\()2.4s, \data_in\()3.4s
        trn2 \data_out\()3.4s, \data_in\()2.4s, \data_in\()3.4s
.endm

.macro save_vregs
        alloc_stack (16*4)
        push_pair d8, d9, 16*0
        push_pair d10, d11, 16*1
        push_pair d12, d13, 16*2
        push_pair d14, d15, 16*3
.endm

.macro restore_vregs
        restore_pair d8, d9, 16*0
        restore_pair d10, d11, 16*1
        restore_pair d12, d13, 16*2
        restore_pair d14, d15, 16*3
        free_stack (16*4)
.endm

.macro push_stack
        save_vregs
.endm

.macro pop_stack
        restore_vregs
.endm

// For comparability reasons, the output range for the coefficients of this
// invNTT code is supposed to match the implementation from PQClean on commit
// ee71d2c823982bfcf54686f3cf1d666f396dc9aa. After the invNTT, the coefficients
// are NOT canonically reduced. The ordering of the coefficients is canonical,
// also matching PQClean.

        in         .req x0
        r12345_ptr .req x1
        r67_ptr    .req x2

        inp     .req x3
        count   .req x4
        wtmp    .req w5

        data0  .req v8
        data1  .req v9
        data2  .req v10
        data3  .req v11
        data4  .req v12
        data5  .req v13
        data6  .req v14
        data7  .req v15

        q_data0  .req q8
        q_data1  .req q9
        q_data2  .req q10
        q_data3  .req q11
        q_data4  .req q12
        q_data5  .req q13
        q_data6  .req q14
        q_data7  .req q15

        root0    .req v0
        root1    .req v1
        root2    .req v2
        root0_tw .req v4
        root1_tw .req v5
        root2_tw .req v6

        consts     .req v7
        q_consts   .req q7

        q_root0    .req q0
        q_root1    .req q1
        q_root2    .req q2
        q_root0_tw .req q4
        q_root1_tw .req q5
        q_root2_tw .req q6

        tmp .req v24
        t0  .req v25
        t1  .req v26
        t2  .req v27
        t3  .req v28

        ninv             .req v29
        ninv_tw          .req v30

        .text
        .global MLK_ASM_NAMESPACE(intt_asm)
        .balign 4
MLK_ASM_FN_SYMBOL(intt_asm)
        .cfi_startproc
        push_stack

        // Setup constants
        mov wtmp, #3329
        mov consts.h[0], wtmp
        mov wtmp, #20159
        mov consts.h[1], wtmp
        mov wtmp, #512
        dup ninv.8h, wtmp
        mov wtmp, #5040
        dup ninv_tw.8h, wtmp

        mov inp, in
        mov count, #8

Lintt_scale_start:

        ldr q_data0, [inp, #(16*0)]
        ldr q_data1, [inp, #(16*1)]
        ldr q_data2, [inp, #(16*2)]
        ldr q_data3, [inp, #(16*3)]

        mul_ninv data0, data1, data2, data3, data0, data1, data2, data3
        // Bounds: Absolute value < q

        str q_data0, [inp], #64
        str q_data1, [inp, #(-64 + 16*1)]
        str q_data2, [inp, #(-64 + 16*2)]
        str q_data3, [inp, #(-64 + 16*3)]

        subs count, count, #1
        cbnz count, Lintt_scale_start

        mov inp, in
        mov count, #8

        .p2align 2
                                               // Instructions:    75
                                               // Expected cycles: 92
                                               // Expected IPC:    0.82
                                               //
                                               // Cycle bound:     92.0
                                               // IPC bound:       0.82
                                               //
                                               // Wall time:     3.78s
                                               // User time:     3.78s
                                               //
                                               // ------------------------------------ cycle (expected) ------------------------------------->
                                               // 0                        25                       50                       75
                                               // |------------------------|------------------------|------------------------|----------------
        ldr q3, [x3, #16]                      // *...........................................................................................
        ldr q20, [x3, #0]                      // ..*.........................................................................................
        ldr q25, [x3, #32]                     // ....*.......................................................................................
        ldr q24, [x3, #48]                     // ......*.....................................................................................
        ldr q21, [x2, #80]                     // ........*...................................................................................
        trn1 v18.4S, v25.4S, v24.4S            // ..........*.................................................................................
        trn1 v6.4S, v20.4S, v3.4S              // ...........*................................................................................
        trn2 v12.4S, v25.4S, v24.4S            // ............*...............................................................................
        trn2 v31.4S, v20.4S, v3.4S             // .............*..............................................................................
        trn2 v28.2D, v6.2D, v18.2D             // ..............*.............................................................................
        trn1 v25.2D, v6.2D, v18.2D             // ...............*............................................................................
        trn2 v15.2D, v31.2D, v12.2D            // ................*...........................................................................
        trn1 v20.2D, v31.2D, v12.2D            // .................*..........................................................................
        add v4.8H, v28.8H, v15.8H              // ..................*.........................................................................
        add v1.8H, v25.8H, v20.8H              // ...................*........................................................................
        sub v30.8H, v28.8H, v15.8H             // ....................*.......................................................................
        sub v3.8H, v25.8H, v20.8H              // .....................*......................................................................
        add v6.8H, v1.8H, v4.8H                // ......................*.....................................................................
        sqrdmulh v9.8H, v30.8H, v21.8H         // .......................*....................................................................
        ldr q21, [x2, #64]                     // ........................*...................................................................
        ldr q25, [x2, #48]                     // ..........................*.................................................................
        mul v21.8H, v30.8H, v21.8H             // ............................*...............................................................
        ldr q30, [x2, #32]                     // .............................*..............................................................
        sub v28.8H, v1.8H, v4.8H               // ...............................*............................................................
        ldr q1, [x2, #16]                      // ................................*...........................................................
        mls v21.8H, v9.8H, v7.H[0]             // ..................................*.........................................................
        sqrdmulh v9.8H, v3.8H, v25.8H          // ...................................*........................................................
        mul v20.8H, v3.8H, v30.8H              // ....................................*.......................................................
        ldr q29, [x2], #(6*16)                 // .....................................*......................................................
        ldr q17, [x3, #96]                     // .......................................*....................................................
        mls v20.8H, v9.8H, v7.H[0]             // .........................................*..................................................
        ldr q3, [x3, #112]                     // ..........................................*.................................................
        mul v4.8H, v28.8H, v29.8H              // ............................................*...............................................
        sub v25.8H, v20.8H, v21.8H             // .............................................*..............................................
        trn1 v15.4S, v17.4S, v3.4S             // ..............................................*.............................................
        sqrdmulh v28.8H, v28.8H, v1.8H         // ...............................................*............................................
        trn2 v31.4S, v17.4S, v3.4S             // ................................................*...........................................
        mul v30.8H, v25.8H, v29.8H             // .................................................*..........................................
        add v20.8H, v20.8H, v21.8H             // ..................................................*.........................................
        mls v4.8H, v28.8H, v7.H[0]             // ...................................................*........................................
        sqrdmulh v3.8H, v25.8H, v1.8H          // ....................................................*.......................................
        ldr q28, [x3, #64]                     // .....................................................*......................................
        trn1 v25.4S, v6.4S, v20.4S             // .......................................................*....................................
        mls v30.8H, v3.8H, v7.H[0]             // ........................................................*...................................
        ldr q27, [x3, #80]                     // .........................................................*..................................
        trn2 v6.4S, v6.4S, v20.4S              // ...........................................................*................................
        trn1 v3.4S, v4.4S, v30.4S              // ............................................................*...............................
        trn2 v10.4S, v28.4S, v27.4S            // .............................................................*..............................
        trn2 v20.4S, v4.4S, v30.4S             // ..............................................................*.............................
        trn2 v8.2D, v25.2D, v3.2D              // ...............................................................*............................
        trn1 v9.2D, v25.2D, v3.2D              // ................................................................*...........................
        trn1 v1.2D, v6.2D, v20.2D              // .................................................................*..........................
        trn2 v30.2D, v6.2D, v20.2D             // ..................................................................*.........................
        add v4.8H, v9.8H, v1.8H                // ...................................................................*........................
        add v11.8H, v8.8H, v30.8H              // ....................................................................*.......................
        trn2 v25.2D, v10.2D, v31.2D            // .....................................................................*......................
        sqdmulh v6.8H, v4.8H, v7.H[1]          // ......................................................................*.....................
        sqdmulh v20.8H, v11.8H, v7.H[1]        // .......................................................................*....................
        ldr q21, [x2, #80]                     // ........................................................................*...................
        srshr v0.8H, v6.8H, #11                // ..........................................................................*.................
        srshr v3.8H, v20.8H, #11               // ...........................................................................*................
        trn1 v2.4S, v28.4S, v27.4S             // ............................................................................*...............
        mls v4.8H, v0.8H, v7.H[0]              // .............................................................................*..............
        mls v11.8H, v3.8H, v7.H[0]             // ..............................................................................*.............
        ldr q0, [x1], #16                      // ...............................................................................*............
        trn2 v20.2D, v2.2D, v15.2D             // .................................................................................*..........
        sub v6.8H, v4.8H, v11.8H               // ..................................................................................*.........
        sub v5.8H, v20.8H, v25.8H              // ...................................................................................*........
        sub v22.8H, v9.8H, v1.8H               // ....................................................................................*.......
        sqrdmulh v3.8H, v6.8H, v0.H[1]         // .....................................................................................*......
        mul v6.8H, v6.8H, v0.H[0]              // ......................................................................................*.....
        sqrdmulh v12.8H, v5.8H, v21.8H         // .......................................................................................*....
        ldr q19, [x2, #64]                     // ........................................................................................*...
        mls v6.8H, v3.8H, v7.H[0]              // ..........................................................................................*.
        ldr q14, [x2], #(6*16)                 // ...........................................................................................*

                                                // ------------------------------------ cycle (expected) ------------------------------------->
                                                // 0                        25                       50                       75
                                                // |------------------------|------------------------|------------------------|----------------
        // ldr q2, [x3, #32]                    // ....*.......................................................................................
        // ldr q19, [x2, #64]                   // ........................*...................................................................
        // ldr q1, [x3, #16]                    // *...........................................................................................
        // ldr q30, [x3, #48]                   // ......*.....................................................................................
        // ldr q16, [x3, #0]                    // ..*.........................................................................................
        // trn1 v15.4S, v2.4S, v30.4S           // ..........*.................................................................................
        // trn2 v31.4S, v2.4S, v30.4S           // ............*...............................................................................
        // ldr q12, [x2, #80]                   // ........*...................................................................................
        // trn2 v10.4S, v16.4S, v1.4S           // .............*..............................................................................
        // ldr q14, [x2], #(6*16)               // .....................................*......................................................
        // trn2 v25.2D, v10.2D, v31.2D          // ................*...........................................................................
        // trn1 v2.4S, v16.4S, v1.4S            // ...........*................................................................................
        // trn2 v20.2D, v2.2D, v15.2D           // ..............*.............................................................................
        // sub v5.8H, v20.8H, v25.8H            // ....................*.......................................................................
        // sqrdmulh v12.8H, v5.8H, v12.8H       // .......................*....................................................................
        // ldr q18, [x2, #-80]                  // ................................*...........................................................
        // mul v26.8H, v5.8H, v19.8H            // ............................*...............................................................
        // trn1 v16.2D, v10.2D, v31.2D          // .................*..........................................................................
        // trn1 v10.2D, v2.2D, v15.2D           // ...............*............................................................................
        // mls v26.8H, v12.8H, v7.H[0]          // ..................................*.........................................................
        // add v11.8H, v10.8H, v16.8H           // ...................*........................................................................
        // add v6.8H, v20.8H, v25.8H            // ..................*.........................................................................
        // ldr q25, [x2, #-64]                  // .............................*..............................................................
        // ldr q28, [x2, #-48]                  // ..........................*.................................................................
        // ldr q2, [x3, #96]                    // .......................................*....................................................
        // ldr q19, [x2, #64]                   // ........................................................................................*...
        // ldr q1, [x3, #80]                    // .........................................................*..................................
        // ldr q30, [x3, #112]                  // ..........................................*.................................................
        // sub v10.8H, v10.8H, v16.8H           // .....................*......................................................................
        // ldr q16, [x3, #64]                   // .....................................................*......................................
        // sqrdmulh v24.8H, v10.8H, v28.8H      // ...................................*........................................................
        // mul v13.8H, v10.8H, v25.8H           // ....................................*.......................................................
        // sub v21.8H, v11.8H, v6.8H            // ...............................*............................................................
        // trn1 v15.4S, v2.4S, v30.4S           // ..............................................*.............................................
        // trn2 v31.4S, v2.4S, v30.4S           // ................................................*...........................................
        // mls v13.8H, v24.8H, v7.H[0]          // .........................................*..................................................
        // mul v29.8H, v21.8H, v14.8H           // ............................................*...............................................
        // ldr q12, [x2, #80]                   // ........................................................................*...................
        // sub v28.8H, v13.8H, v26.8H           // .............................................*..............................................
        // trn2 v10.4S, v16.4S, v1.4S           // .............................................................*..............................
        // add v30.8H, v11.8H, v6.8H            // ......................*.....................................................................
        // sqrdmulh v2.8H, v28.8H, v18.8H       // ....................................................*.......................................
        // mul v8.8H, v28.8H, v14.8H            // .................................................*..........................................
        // sqrdmulh v18.8H, v21.8H, v18.8H      // ...............................................*............................................
        // ldr q14, [x2], #(6*16)               // ...........................................................................................*
        // mls v8.8H, v2.8H, v7.H[0]            // ........................................................*...................................
        // add v11.8H, v13.8H, v26.8H           // ..................................................*.........................................
        // mls v29.8H, v18.8H, v7.H[0]          // ...................................................*........................................
        // trn1 v23.4S, v30.4S, v11.4S          // .......................................................*....................................
        // trn2 v28.4S, v30.4S, v11.4S          // ...........................................................*................................
        // trn2 v13.4S, v29.4S, v8.4S           // ..............................................................*.............................
        // trn1 v11.4S, v29.4S, v8.4S           // ............................................................*...............................
        // trn1 v21.2D, v28.2D, v13.2D          // .................................................................*..........................
        // trn2 v8.2D, v23.2D, v11.2D           // ...............................................................*............................
        // trn1 v24.2D, v23.2D, v11.2D          // ................................................................*...........................
        // trn2 v30.2D, v28.2D, v13.2D          // ..................................................................*.........................
        // add v4.8H, v24.8H, v21.8H            // ...................................................................*........................
        // add v11.8H, v8.8H, v30.8H            // ....................................................................*.......................
        // sqdmulh v17.8H, v4.8H, v7.H[1]       // ......................................................................*.....................
        // sqdmulh v29.8H, v11.8H, v7.H[1]      // .......................................................................*....................
        // trn2 v25.2D, v10.2D, v31.2D          // .....................................................................*......................
        // srshr v28.8H, v17.8H, #11            // ..........................................................................*.................
        // srshr v13.8H, v29.8H, #11            // ...........................................................................*................
        // mls v4.8H, v28.8H, v7.H[0]           // .............................................................................*..............
        // mls v11.8H, v13.8H, v7.H[0]          // ..............................................................................*.............
        // sub v29.8H, v4.8H, v11.8H            // ..................................................................................*.........
        // ldr q0, [x1], #16                    // ...............................................................................*............
        // trn1 v2.4S, v16.4S, v1.4S            // ............................................................................*...............
        // sqrdmulh v3.8H, v29.8H, v0.H[1]      // .....................................................................................*......
        // mul v6.8H, v29.8H, v0.H[0]           // ......................................................................................*.....
        // trn2 v20.2D, v2.2D, v15.2D           // .................................................................................*..........
        // sub v5.8H, v20.8H, v25.8H            // ...................................................................................*........
        // mls v6.8H, v3.8H, v7.H[0]            // ..........................................................................................*.
        // sub v22.8H, v24.8H, v21.8H           // ....................................................................................*.......
        // sqrdmulh v12.8H, v5.8H, v12.8H       // .......................................................................................*....

        sub count, count, #2
Lintt_layer4567_start:
                                                // Instructions:    80
                                                // Expected cycles: 91
                                                // Expected IPC:    0.88
                                                //
                                                // Cycle bound:     91.0
                                                // IPC bound:       0.88
                                                //
                                                // Wall time:     20.53s
                                                // User time:     20.53s
                                                //
                                                // ------------------------------------ cycle (expected) ------------------------------------>
                                                // 0                        25                       50                       75
                                                // |------------------------|------------------------|------------------------|---------------
        str q6, [x3, #32]                       // l..........................................................................................
        ldr q18, [x2, #-80]                     // .*.........................................................................................
        mul v26.8H, v5.8H, v19.8H               // ...*.......................................................................................
        trn1 v16.2D, v10.2D, v31.2D             // ....*......................................................................................
        mul v27.8H, v22.8H, v0.H[2]             // .....l.....................................................................................
        trn1 v10.2D, v2.2D, v15.2D              // ......*....................................................................................
        add v5.8H, v4.8H, v11.8H                // .......l...................................................................................
        mls v26.8H, v12.8H, v7.H[0]             // ........*..................................................................................
        add v11.8H, v10.8H, v16.8H              // .........*.................................................................................
        add v6.8H, v20.8H, v25.8H               // ..........*................................................................................
        ldr q25, [x2, #-64]                     // ...........*...............................................................................
        ldr q28, [x2, #-48]                     // .............*.............................................................................
        ldr q2, [x3, #160]                      // ...............e...........................................................................
        ldr q19, [x2, #64]                      // .................e.........................................................................
        sub v17.8H, v8.8H, v30.8H               // ...................l.......................................................................
        ldr q1, [x3, #144]                      // ....................e......................................................................
        sqrdmulh v9.8H, v17.8H, v0.H[5]         // ......................l....................................................................
        str q5, [x3], #(64)                     // .......................l...................................................................
        ldr q30, [x3, #112]                     // ........................e..................................................................
        sub v10.8H, v10.8H, v16.8H              // ..........................*................................................................
        ldr q16, [x3, #64]                      // ...........................e...............................................................
        sqrdmulh v24.8H, v10.8H, v28.8H         // .............................*.............................................................
        mul v13.8H, v10.8H, v25.8H              // ..............................*............................................................
        sub v21.8H, v11.8H, v6.8H               // ...............................*...........................................................
        trn1 v15.4S, v2.4S, v30.4S              // ................................e..........................................................
        trn2 v31.4S, v2.4S, v30.4S              // .................................e.........................................................
        mls v13.8H, v24.8H, v7.H[0]             // ..................................*........................................................
        mul v29.8H, v21.8H, v14.8H              // ...................................*.......................................................
        ldr q12, [x2, #80]                      // ....................................e......................................................
        sub v28.8H, v13.8H, v26.8H              // ......................................*....................................................
        trn2 v10.4S, v16.4S, v1.4S              // .......................................e...................................................
        add v30.8H, v11.8H, v6.8H               // ........................................*..................................................
        sqrdmulh v2.8H, v28.8H, v18.8H          // .........................................*.................................................
        mul v8.8H, v28.8H, v14.8H               // ..........................................*................................................
        sqrdmulh v18.8H, v21.8H, v18.8H         // ...........................................*...............................................
        ldr q14, [x2], #(6*16)                  // ............................................e..............................................
        mls v8.8H, v2.8H, v7.H[0]               // ..............................................*............................................
        add v11.8H, v13.8H, v26.8H              // ...............................................*...........................................
        mls v29.8H, v18.8H, v7.H[0]             // ................................................*..........................................
        sqrdmulh v20.8H, v22.8H, v0.H[3]        // .................................................l.........................................
        trn1 v23.4S, v30.4S, v11.4S             // ..................................................*........................................
        trn2 v28.4S, v30.4S, v11.4S             // ...................................................*.......................................
        trn2 v13.4S, v29.4S, v8.4S              // ....................................................*......................................
        trn1 v11.4S, v29.4S, v8.4S              // .....................................................*.....................................
        mls v27.8H, v20.8H, v7.H[0]             // ......................................................l....................................
        trn1 v21.2D, v28.2D, v13.2D             // .......................................................*...................................
        trn2 v8.2D, v23.2D, v11.2D              // ........................................................*..................................
        trn1 v24.2D, v23.2D, v11.2D             // .........................................................*.................................
        mul v26.8H, v17.8H, v0.H[4]             // ..........................................................l................................
        trn2 v30.2D, v28.2D, v13.2D             // ...........................................................*...............................
        add v4.8H, v24.8H, v21.8H               // ............................................................*..............................
        add v11.8H, v8.8H, v30.8H               // .............................................................*.............................
        mls v26.8H, v9.8H, v7.H[0]              // ..............................................................l............................
        sqdmulh v17.8H, v4.8H, v7.H[1]          // ...............................................................*...........................
        sqdmulh v29.8H, v11.8H, v7.H[1]         // ................................................................*..........................
        trn2 v25.2D, v10.2D, v31.2D             // .................................................................e.........................
        add v2.8H, v27.8H, v26.8H               // ..................................................................l........................
        srshr v28.8H, v17.8H, #11               // ...................................................................*.......................
        srshr v13.8H, v29.8H, #11               // ....................................................................*......................
        sqdmulh v20.8H, v2.8H, v7.H[1]          // .....................................................................l.....................
        sub v5.8H, v27.8H, v26.8H               // ......................................................................l....................
        mls v4.8H, v28.8H, v7.H[0]              // .......................................................................*...................
        mls v11.8H, v13.8H, v7.H[0]             // ........................................................................*..................
        srshr v23.8H, v20.8H, #11               // .........................................................................l.................
        sqrdmulh v17.8H, v5.8H, v0.H[1]         // ..........................................................................l................
        mul v9.8H, v5.8H, v0.H[0]               // ...........................................................................l...............
        mls v2.8H, v23.8H, v7.H[0]              // ............................................................................l..............
        sub v29.8H, v4.8H, v11.8H               // .............................................................................*.............
        ldr q0, [x1], #16                       // ..............................................................................*............
        str q2, [x3, #-48]                      // ................................................................................l..........
        trn1 v2.4S, v16.4S, v1.4S               // .................................................................................e.........
        sqrdmulh v3.8H, v29.8H, v0.H[1]         // ..................................................................................*........
        mul v6.8H, v29.8H, v0.H[0]              // ...................................................................................*.......
        trn2 v20.2D, v2.2D, v15.2D              // ....................................................................................e......
        mls v9.8H, v17.8H, v7.H[0]              // .....................................................................................l.....
        sub v5.8H, v20.8H, v25.8H               // ......................................................................................e....
        mls v6.8H, v3.8H, v7.H[0]               // .......................................................................................*...
        sub v22.8H, v24.8H, v21.8H              // ........................................................................................*..
        str q9, [x3, #-16]                      // .........................................................................................l.
        sqrdmulh v12.8H, v5.8H, v12.8H          // ..........................................................................................e

                                                      // ----------------------------------------------------------------------------------------------------------------------- cycle (expected) ----------------------------------------------------------------------------------------------------------------------->
                                                      // 0                        25                       50                       75                       100                      125                      150                      175                      200                      225                      250
                                                      // |------------------------|------------------------|------------------------|------------------------|------------------------|------------------------|------------------------|------------------------|------------------------|------------------------|------
        // ldr q8, [x3, #(16*0)]                      // ............e...............................................................'..........................~...............................................................'..........................~..............................................................
        // ldr q9, [x3, #(16*1)]                      // .....e......................................................................'...................~......................................................................'...................~.....................................................................
        // ldr q10, [x3, #(16*2)]                     // e...........................................................................'..............~...........................................................................'..............~..........................................................................
        // ldr q11, [x3, #(16*3)]                     // .........e..................................................................'.......................~..................................................................'.......................~.................................................................
        // trn1 v25.4s, v8.4s, v9.4s                  // ..................................................................e.........'................................................................................~.........'................................................................................~........
        // trn2 v26.4s, v8.4s, v9.4s                  // ........................e...................................................'......................................~...................................................'......................................~..................................................
        // trn1 v27.4s, v10.4s, v11.4s                // .................e..........................................................'...............................~..........................................................'...............................~.........................................................
        // trn2 v28.4s, v10.4s, v11.4s                // ..................e.........................................................'................................~.........................................................'................................~........................................................
        // trn2 v10.2d, v25.2d, v27.2d                // .....................................................................e......'...................................................................................~......'...................................................................................~.....
        // trn2 v11.2d, v26.2d, v28.2d                // ..................................................e.........................'................................................................~.........................'................................................................~........................
        // trn1 v8.2d, v25.2d, v27.2d                 // ............................................................................'.....*....................................................................................'.....~...................................................................................
        // trn1 v9.2d, v26.2d, v28.2d                 // ............................................................................'...*......................................................................................'...~.....................................................................................
        // ldr q0,    [x2], #(6*16)                   // .............................e..............................................'...........................................~..............................................'...........................................~.............................................
        // ldr q4, [x2, #(-6*16 + 1*16)]              // ............................................................................'*.........................................................................................'~........................................................................................
        // ldr q1,    [x2, #(-6*16 + 2*16)]           // ............................................................................'..........*...............................................................................'..........~..............................................................................
        // ldr q5, [x2, #(-6*16 + 3*16)]              // ............................................................................'............*.............................................................................'............~............................................................................
        // ldr q2,    [x2, #(-6*16 + 4*16)]           // ..e.........................................................................'................~.........................................................................'................~........................................................................
        // ldr q6, [x2, #(-6*16 + 5*16)]              // .....................e......................................................'...................................~......................................................'...................................~.....................................................
        // sub v24.8h,   v8.8h, v9.8h                 // ...........~................................................................'.........................*................................................................'.........................~...............................................................
        // add v8.8h, v8.8h, v9.8h                    // ............................................................................'........*.................................................................................'........~................................................................................
        // sqrdmulh v27.8h,      v24.8h, v5.8h        // ..............~.............................................................'............................*.............................................................'............................~............................................................
        // mul      v9.8h, v24.8h, v1.8h              // ...............~............................................................'.............................*............................................................'.............................~...........................................................
        // mls      v9.8h, v27.8h,      v7.h[0]       // ...................~........................................................'.................................*........................................................'.................................~.......................................................
        // sub v24.8h,   v10.8h, v11.8h               // .......................................................................e....'.....................................................................................~....'.....................................................................................~...
        // add v10.8h, v10.8h, v11.8h                 // ............................................................................'.........*................................................................................'.........~...............................................................................
        // sqrdmulh v27.8h,      v24.8h, v6.8h        // ...........................................................................e'.........................................................................................~'.........................................................................................
        // mul      v11.8h, v24.8h, v2.8h             // ............................................................................'..*.......................................................................................'..~......................................................................................
        // mls      v11.8h, v27.8h,      v7.h[0]      // ............................................................................'.......*..................................................................................'.......~.................................................................................
        // sub v24.8h,   v8.8h, v10.8h                // ................~...........................................................'..............................*...........................................................'..............................~..........................................................
        // add v8.8h, v8.8h, v10.8h                   // .........................~..................................................'.......................................*..................................................'.......................................~.................................................
        // sqrdmulh v27.8h,      v24.8h, v4.8h        // ............................~...............................................'..........................................*...............................................'..........................................~..............................................
        // mul      v10.8h, v24.8h, v0.8h             // ....................~.......................................................'..................................*.......................................................'..................................~......................................................
        // mls      v10.8h, v27.8h,      v7.h[0]      // .................................~..........................................'...............................................*..........................................'...............................................~.........................................
        // sub v24.8h,   v9.8h, v11.8h                // .......................~....................................................'.....................................*....................................................'.....................................~...................................................
        // add v9.8h, v9.8h, v11.8h                   // ................................~...........................................'..............................................*...........................................'..............................................~..........................................
        // sqrdmulh v27.8h,      v24.8h, v4.8h        // ..........................~.................................................'........................................*.................................................'........................................~................................................
        // mul      v11.8h, v24.8h, v0.8h             // ...........................~................................................'.........................................*................................................'.........................................~...............................................
        // mls      v11.8h, v27.8h,      v7.h[0]      // ...............................~............................................'.............................................*............................................'.............................................~...........................................
        // trn1 v25.4s, v8.4s, v9.4s                  // ...................................~........................................'.................................................*........................................'.................................................~.......................................
        // trn2 v26.4s, v8.4s, v9.4s                  // ....................................~.......................................'..................................................*.......................................'..................................................~......................................
        // trn1 v27.4s, v10.4s, v11.4s                // ......................................~.....................................'....................................................*.....................................'....................................................~....................................
        // trn2 v28.4s, v10.4s, v11.4s                // .....................................~......................................'...................................................*......................................'...................................................~.....................................
        // trn2 v10.2d, v25.2d, v27.2d                // .........................................~..................................'.......................................................*..................................'.......................................................~.................................
        // trn2 v11.2d, v26.2d, v28.2d                // ............................................~...............................'..........................................................*...............................'..........................................................~..............................
        // trn1 v8.2d, v25.2d, v27.2d                 // ..........................................~.................................'........................................................*.................................'........................................................~................................
        // trn1 v9.2d, v26.2d, v28.2d                 // ........................................~...................................'......................................................*...................................'......................................................~..................................
        // ldr q0, [x1], #16                          // ...............................................................~............'.............................................................................*............'.............................................................................~...........
        // sub v24.8h,   v8.8h, v9.8h                 // .........................................................................~..'.......................................................................................*..'.......................................................................................~.
        // add v8.8h, v8.8h, v9.8h                    // .............................................~..............................'...........................................................*..............................'...........................................................~.............................
        // sqrdmulh v27.8h,      v24.8h, v0.h[3]      // ..................................~.........................................'................................................~.........................................'................................................l........................................
        // mul      v9.8h, v24.8h, v0.h[2]            // ............................................................................'....~.....................................................................................'....l....................................................................................
        // mls      v9.8h, v27.8h,      v7.h[0]       // .......................................~....................................'.....................................................~....................................'.....................................................l...................................
        // sub v24.8h,   v10.8h, v11.8h               // ....~.......................................................................'..................~.......................................................................'..................l......................................................................
        // add v10.8h, v10.8h, v11.8h                 // ..............................................~.............................'............................................................*.............................'............................................................~............................
        // sqrdmulh v27.8h,      v24.8h, v0.h[5]      // .......~....................................................................'.....................~....................................................................'.....................l...................................................................
        // mul      v11.8h, v24.8h, v0.h[4]           // ...........................................~................................'.........................................................~................................'.........................................................l...............................
        // mls      v11.8h, v27.8h,      v7.h[0]      // ...............................................~............................'.............................................................~............................'.............................................................l...........................
        // sqdmulh v25.8h,    v8.8h, v7.h[1]          // ................................................~...........................'..............................................................*...........................'..............................................................~..........................
        // srshr   v25.8h,    v25.8h,    #11          // ....................................................~.......................'..................................................................*.......................'..................................................................~......................
        // mls     v8.8h, v25.8h,    v7.h[0]          // ........................................................~...................'......................................................................*...................'......................................................................~..................
        // sqdmulh v25.8h,    v10.8h, v7.h[1]         // .................................................~..........................'...............................................................*..........................'...............................................................~.........................
        // srshr   v25.8h,    v25.8h,    #11          // .....................................................~......................'...................................................................*......................'...................................................................~.....................
        // mls     v10.8h, v25.8h,    v7.h[0]         // .........................................................~..................'.......................................................................*..................'.......................................................................~.................
        // sub v24.8h,   v8.8h, v10.8h                // ..............................................................~.............'............................................................................*.............'............................................................................~............
        // add v8.8h, v8.8h, v10.8h                   // ............................................................................'......~...................................................................................'......l..................................................................................
        // sqrdmulh v27.8h,      v24.8h, v0.h[1]      // ...................................................................~........'.................................................................................*........'.................................................................................~.......
        // mul      v10.8h, v24.8h, v0.h[0]           // ....................................................................~.......'..................................................................................*.......'..................................................................................~......
        // mls      v10.8h, v27.8h,      v7.h[0]      // ........................................................................~...'......................................................................................*...'......................................................................................~..
        // sub v24.8h,   v9.8h, v11.8h                // .......................................................~....................'.....................................................................~....................'.....................................................................l...................
        // add v9.8h, v9.8h, v11.8h                   // ...................................................~........................'.................................................................~........................'.................................................................l.......................
        // sqrdmulh v27.8h,      v24.8h, v0.h[1]      // ...........................................................~................'.........................................................................~................'.........................................................................l...............
        // mul      v11.8h, v24.8h, v0.h[0]           // ............................................................~...............'..........................................................................~...............'..........................................................................l..............
        // mls      v11.8h, v27.8h,      v7.h[0]      // ......................................................................~.....'....................................................................................~.....'....................................................................................l....
        // sqdmulh v25.8h,    v9.8h, v7.h[1]          // ......................................................~.....................'....................................................................~.....................'....................................................................l....................
        // srshr   v25.8h,    v25.8h,    #11          // ..........................................................~.................'........................................................................~.................'........................................................................l................
        // mls     v9.8h, v25.8h,    v7.h[0]          // .............................................................~..............'...........................................................................~..............'...........................................................................l.............
        // str q8, [x3], #(64)                        // ........~...................................................................'......................~...................................................................'......................l..................................................................
        // str q9, [x3, #(-64 + 16*1)]                // .................................................................~..........'...............................................................................~..........'...............................................................................l.........
        // str q10, [x3, #(-64 + 16*2)]               // ............................................................................~..........................................................................................l.........................................................................................
        // str q11, [x3, #(-64 + 16*3)]               // ..........................................................................~.'........................................................................................~.'........................................................................................l

        subs count, count, 1
        cbnz count, Lintt_layer4567_start
                                                // Instructions:    85
                                                // Expected cycles: 91
                                                // Expected IPC:    0.93
                                                //
                                                // Cycle bound:     91.0
                                                // IPC bound:       0.93
                                                //
                                                // Wall time:     24.87s
                                                // User time:     24.87s
                                                //
                                                // ------------------------------------ cycle (expected) ------------------------------------>
                                                // 0                        25                       50                       75
                                                // |------------------------|------------------------|------------------------|---------------
        mul v21.8H, v22.8H, v0.H[2]             // *..........................................................................................
        mul v28.8H, v5.8H, v19.8H               // .*.........................................................................................
        trn1 v10.2D, v10.2D, v31.2D             // ..*........................................................................................
        trn1 v2.2D, v2.2D, v15.2D               // ...*.......................................................................................
        add v11.8H, v4.8H, v11.8H               // ....*......................................................................................
        sub v30.8H, v8.8H, v30.8H               // .....*.....................................................................................
        add v23.8H, v20.8H, v25.8H              // ......*....................................................................................
        add v24.8H, v2.8H, v10.8H               // .......*...................................................................................
        mul v8.8H, v30.8H, v0.H[4]              // ........*..................................................................................
        sqrdmulh v5.8H, v30.8H, v0.H[5]         // .........*.................................................................................
        sqrdmulh v22.8H, v22.8H, v0.H[3]        // ..........*................................................................................
        add v30.8H, v24.8H, v23.8H              // ...........*...............................................................................
        ldr q26, [x2, #-48]                     // ............*..............................................................................
        mls v8.8H, v5.8H, v7.H[0]               // ..............*............................................................................
        sub v5.8H, v2.8H, v10.8H                // ...............*...........................................................................
        ldr q13, [x2, #-64]                     // ................*..........................................................................
        mls v21.8H, v22.8H, v7.H[0]             // ..................*........................................................................
        str q6, [x3, #32]                       // ...................*.......................................................................
        mul v3.8H, v5.8H, v13.8H                // ....................*......................................................................
        sqrdmulh v22.8H, v5.8H, v26.8H          // .....................*.....................................................................
        sub v18.8H, v21.8H, v8.8H               // ......................*....................................................................
        mls v28.8H, v12.8H, v7.H[0]             // .......................*...................................................................
        str q11, [x3], #(64)                    // ........................*..................................................................
        mls v3.8H, v22.8H, v7.H[0]              // .........................*.................................................................
        sqrdmulh v16.8H, v18.8H, v0.H[1]        // ..........................*................................................................
        sub v10.8H, v24.8H, v23.8H              // ...........................*...............................................................
        mul v17.8H, v18.8H, v0.H[0]             // ............................*..............................................................
        sub v11.8H, v3.8H, v28.8H               // .............................*.............................................................
        mul v13.8H, v10.8H, v14.8H              // ..............................*............................................................
        add v22.8H, v3.8H, v28.8H               // ...............................*...........................................................
        mul v14.8H, v11.8H, v14.8H              // ................................*..........................................................
        ldr q26, [x2, #-80]                     // .................................*.........................................................
        trn2 v2.4S, v30.4S, v22.4S              // ...................................*.......................................................
        mls v17.8H, v16.8H, v7.H[0]             // ....................................*......................................................
        sqrdmulh v10.8H, v10.8H, v26.8H         // .....................................*.....................................................
        sqrdmulh v11.8H, v11.8H, v26.8H         // ......................................*....................................................
        ldr q9, [x1], #16                       // .......................................*...................................................
        mls v13.8H, v10.8H, v7.H[0]             // .........................................*.................................................
        mls v14.8H, v11.8H, v7.H[0]             // ..........................................*................................................
        trn1 v6.4S, v30.4S, v22.4S              // ...........................................*...............................................
        add v8.8H, v21.8H, v8.8H                // ............................................*..............................................
        str q17, [x3, #-16]                     // .............................................*.............................................
        trn2 v0.4S, v13.4S, v14.4S              // ..............................................*............................................
        trn1 v1.4S, v13.4S, v14.4S              // ...............................................*...........................................
        sqdmulh v13.8H, v8.8H, v7.H[1]          // ................................................*..........................................
        trn1 v24.2D, v2.2D, v0.2D               // .................................................*.........................................
        trn2 v2.2D, v2.2D, v0.2D                // ..................................................*........................................
        trn2 v26.2D, v6.2D, v1.2D               // ...................................................*.......................................
        trn1 v11.2D, v6.2D, v1.2D               // ....................................................*......................................
        add v22.8H, v26.8H, v2.8H               // .....................................................*.....................................
        sub v28.8H, v11.8H, v24.8H              // ......................................................*....................................
        sub v27.8H, v26.8H, v2.8H               // .......................................................*...................................
        add v10.8H, v11.8H, v24.8H              // ........................................................*..................................
        sqrdmulh v11.8H, v28.8H, v9.H[3]        // .........................................................*.................................
        mul v24.8H, v28.8H, v9.H[2]             // ..........................................................*................................
        sqdmulh v1.8H, v22.8H, v7.H[1]          // ...........................................................*...............................
        sqrdmulh v0.8H, v27.8H, v9.H[5]         // ............................................................*..............................
        srshr v12.8H, v13.8H, #11               // .............................................................*.............................
        mls v24.8H, v11.8H, v7.H[0]             // ..............................................................*............................
        sqdmulh v14.8H, v10.8H, v7.H[1]         // ...............................................................*...........................
        mul v27.8H, v27.8H, v9.H[4]             // ................................................................*..........................
        mls v8.8H, v12.8H, v7.H[0]              // .................................................................*.........................
        srshr v5.8H, v1.8H, #11                 // ..................................................................*........................
        srshr v14.8H, v14.8H, #11               // ...................................................................*.......................
        mls v27.8H, v0.8H, v7.H[0]              // ....................................................................*......................
        mls v22.8H, v5.8H, v7.H[0]              // .....................................................................*.....................
        mls v10.8H, v14.8H, v7.H[0]             // ......................................................................*....................
        str q8, [x3, #-48]                      // .......................................................................*...................
        sub v2.8H, v24.8H, v27.8H               // ........................................................................*..................
        add v14.8H, v24.8H, v27.8H              // .........................................................................*.................
        sub v11.8H, v10.8H, v22.8H              // ..........................................................................*................
        add v20.8H, v10.8H, v22.8H              // ...........................................................................*...............
        sqdmulh v22.8H, v14.8H, v7.H[1]         // ............................................................................*..............
        sqrdmulh v8.8H, v11.8H, v9.H[1]         // .............................................................................*.............
        mul v27.8H, v11.8H, v9.H[0]             // ..............................................................................*............
        sqrdmulh v0.8H, v2.8H, v9.H[1]          // ...............................................................................*...........
        mul v11.8H, v2.8H, v9.H[0]              // ................................................................................*..........
        srshr v10.8H, v22.8H, #11               // .................................................................................*.........
        mls v27.8H, v8.8H, v7.H[0]              // ..................................................................................*........
        str q20, [x3], #(64)                    // ...................................................................................*.......
        mls v11.8H, v0.8H, v7.H[0]              // ....................................................................................*......
        mls v14.8H, v10.8H, v7.H[0]             // .....................................................................................*.....
        str q27, [x3, #-32]                     // ......................................................................................*....
        str q11, [x3, #-16]                     // ........................................................................................*..
        str q14, [x3, #-48]                     // ..........................................................................................*

                                                 // ------------------------------------ cycle (expected) ------------------------------------>
                                                 // 0                        25                       50                       75
                                                 // |------------------------|------------------------|------------------------|---------------
        // str q6, [x3, #32]                     // ...................*.......................................................................
        // ldr q18, [x2, #-80]                   // .................................*.........................................................
        // mul v26.8H, v5.8H, v19.8H             // .*.........................................................................................
        // trn1 v16.2D, v10.2D, v31.2D           // ..*........................................................................................
        // mul v27.8H, v22.8H, v0.H[2]           // *..........................................................................................
        // trn1 v10.2D, v2.2D, v15.2D            // ...*.......................................................................................
        // add v5.8H, v4.8H, v11.8H              // ....*......................................................................................
        // mls v26.8H, v12.8H, v7.H[0]           // .......................*...................................................................
        // add v11.8H, v10.8H, v16.8H            // .......*...................................................................................
        // add v6.8H, v20.8H, v25.8H             // ......*....................................................................................
        // ldr q25, [x2, #-64]                   // ................*..........................................................................
        // ldr q28, [x2, #-48]                   // ............*..............................................................................
        // sub v17.8H, v8.8H, v30.8H             // .....*.....................................................................................
        // sqrdmulh v9.8H, v17.8H, v0.H[5]       // .........*.................................................................................
        // str q5, [x3], #(64)                   // ........................*..................................................................
        // sub v10.8H, v10.8H, v16.8H            // ...............*...........................................................................
        // sqrdmulh v24.8H, v10.8H, v28.8H       // .....................*.....................................................................
        // mul v13.8H, v10.8H, v25.8H            // ....................*......................................................................
        // sub v21.8H, v11.8H, v6.8H             // ...........................*...............................................................
        // mls v13.8H, v24.8H, v7.H[0]           // .........................*.................................................................
        // mul v29.8H, v21.8H, v14.8H            // ..............................*............................................................
        // sub v28.8H, v13.8H, v26.8H            // .............................*.............................................................
        // add v30.8H, v11.8H, v6.8H             // ...........*...............................................................................
        // sqrdmulh v2.8H, v28.8H, v18.8H        // ......................................*....................................................
        // mul v8.8H, v28.8H, v14.8H             // ................................*..........................................................
        // sqrdmulh v18.8H, v21.8H, v18.8H       // .....................................*.....................................................
        // mls v8.8H, v2.8H, v7.H[0]             // ..........................................*................................................
        // add v11.8H, v13.8H, v26.8H            // ...............................*...........................................................
        // mls v29.8H, v18.8H, v7.H[0]           // .........................................*.................................................
        // sqrdmulh v20.8H, v22.8H, v0.H[3]      // ..........*................................................................................
        // trn1 v23.4S, v30.4S, v11.4S           // ...........................................*...............................................
        // trn2 v28.4S, v30.4S, v11.4S           // ...................................*.......................................................
        // trn2 v13.4S, v29.4S, v8.4S            // ..............................................*............................................
        // trn1 v11.4S, v29.4S, v8.4S            // ...............................................*...........................................
        // mls v27.8H, v20.8H, v7.H[0]           // ..................*........................................................................
        // trn1 v21.2D, v28.2D, v13.2D           // .................................................*.........................................
        // trn2 v8.2D, v23.2D, v11.2D            // ...................................................*.......................................
        // trn1 v24.2D, v23.2D, v11.2D           // ....................................................*......................................
        // mul v26.8H, v17.8H, v0.H[4]           // ........*..................................................................................
        // trn2 v30.2D, v28.2D, v13.2D           // ..................................................*........................................
        // add v4.8H, v24.8H, v21.8H             // ........................................................*..................................
        // add v11.8H, v8.8H, v30.8H             // .....................................................*.....................................
        // mls v26.8H, v9.8H, v7.H[0]            // ..............*............................................................................
        // sqdmulh v17.8H, v4.8H, v7.H[1]        // ...............................................................*...........................
        // sqdmulh v29.8H, v11.8H, v7.H[1]       // ...........................................................*...............................
        // add v2.8H, v27.8H, v26.8H             // ............................................*..............................................
        // srshr v28.8H, v17.8H, #11             // ...................................................................*.......................
        // srshr v13.8H, v29.8H, #11             // ..................................................................*........................
        // sqdmulh v20.8H, v2.8H, v7.H[1]        // ................................................*..........................................
        // sub v5.8H, v27.8H, v26.8H             // ......................*....................................................................
        // mls v4.8H, v28.8H, v7.H[0]            // ......................................................................*....................
        // mls v11.8H, v13.8H, v7.H[0]           // .....................................................................*.....................
        // srshr v23.8H, v20.8H, #11             // .............................................................*.............................
        // sqrdmulh v17.8H, v5.8H, v0.H[1]       // ..........................*................................................................
        // mul v9.8H, v5.8H, v0.H[0]             // ............................*..............................................................
        // mls v2.8H, v23.8H, v7.H[0]            // .................................................................*.........................
        // sub v29.8H, v4.8H, v11.8H             // ..........................................................................*................
        // ldr q0, [x1], #16                     // .......................................*...................................................
        // str q2, [x3, #-48]                    // .......................................................................*...................
        // sqrdmulh v3.8H, v29.8H, v0.H[1]       // .............................................................................*.............
        // mul v6.8H, v29.8H, v0.H[0]            // ..............................................................................*............
        // mls v9.8H, v17.8H, v7.H[0]            // ....................................*......................................................
        // mls v6.8H, v3.8H, v7.H[0]             // ..................................................................................*........
        // sub v22.8H, v24.8H, v21.8H            // ......................................................*....................................
        // str q9, [x3, #-16]                    // .............................................*.............................................
        // str q6, [x3, #32]                     // ......................................................................................*....
        // mul v27.8H, v22.8H, v0.H[2]           // ..........................................................*................................
        // add v5.8H, v4.8H, v11.8H              // ...........................................................................*...............
        // sub v17.8H, v8.8H, v30.8H             // .......................................................*...................................
        // sqrdmulh v9.8H, v17.8H, v0.H[5]       // ............................................................*..............................
        // str q5, [x3], #(64)                   // ...................................................................................*.......
        // sqrdmulh v20.8H, v22.8H, v0.H[3]      // .........................................................*.................................
        // mls v27.8H, v20.8H, v7.H[0]           // ..............................................................*............................
        // mul v26.8H, v17.8H, v0.H[4]           // ................................................................*..........................
        // mls v26.8H, v9.8H, v7.H[0]            // ....................................................................*......................
        // add v2.8H, v27.8H, v26.8H             // .........................................................................*.................
        // sqdmulh v20.8H, v2.8H, v7.H[1]        // ............................................................................*..............
        // sub v5.8H, v27.8H, v26.8H             // ........................................................................*..................
        // srshr v23.8H, v20.8H, #11             // .................................................................................*.........
        // sqrdmulh v17.8H, v5.8H, v0.H[1]       // ...............................................................................*...........
        // mul v9.8H, v5.8H, v0.H[0]             // ................................................................................*..........
        // mls v2.8H, v23.8H, v7.H[0]            // .....................................................................................*.....
        // str q2, [x3, #-48]                    // ..........................................................................................*
        // mls v9.8H, v17.8H, v7.H[0]            // ....................................................................................*......
        // str q9, [x3, #-16]                    // ........................................................................................*..


        // ---------------------------------------------------------------------

        mov count, #4
        load_roots_123

        .p2align 2

                                                // Instructions:    77
                                                // Expected cycles: 88
                                                // Expected IPC:    0.88
                                                //
                                                // Cycle bound:     88.0
                                                // IPC bound:       0.88
                                                //
                                                // Wall time:     0.68s
                                                // User time:     0.68s
                                                //
                                                // ---------------------------------- cycle (expected) ----------------------------------->
                                                // 0                        25                       50                       75
                                                // |------------------------|------------------------|------------------------|------------
        ldr q2, [x0, #0]                        // *.......................................................................................
        ldr q10, [x0, #64]                      // ..*.....................................................................................
        ldr q11, [x0, #128]                     // ....*...................................................................................
        sub v14.8H, v2.8H, v10.8H               // ......*.................................................................................
        add v2.8H, v2.8H, v10.8H                // .......*................................................................................
        ldr q10, [x0, #192]                     // ........*...............................................................................
        sqrdmulh v8.8H, v14.8H, v0.H[7]         // ..........*.............................................................................
        mul v14.8H, v14.8H, v0.H[6]             // ...........*............................................................................
        sub v22.8H, v11.8H, v10.8H              // ............*...........................................................................
        add v10.8H, v11.8H, v10.8H              // .............*..........................................................................
        ldr q11, [x0, #448]                     // ..............*.........................................................................
        add v13.8H, v2.8H, v10.8H               // ................*.......................................................................
        sub v2.8H, v2.8H, v10.8H                // .................*......................................................................
        sqrdmulh v10.8H, v22.8H, v1.H[1]        // ..................*.....................................................................
        mul v22.8H, v22.8H, v1.H[0]             // ...................*....................................................................
        mls v14.8H, v8.8H, v7.H[0]              // ....................*...................................................................
        sqrdmulh v8.8H, v2.8H, v0.H[3]          // .....................*..................................................................
        mul v2.8H, v2.8H, v0.H[2]               // ......................*.................................................................
        mls v22.8H, v10.8H, v7.H[0]             // .......................*................................................................
        ldr q10, [x0, #256]                     // ........................*...............................................................
        mls v2.8H, v8.8H, v7.H[0]               // ..........................*.............................................................
        sub v8.8H, v14.8H, v22.8H               // ...........................*............................................................
        add v14.8H, v14.8H, v22.8H              // ............................*...........................................................
        ldr q22, [x0, #384]                     // .............................*..........................................................
        sqrdmulh v24.8H, v8.8H, v0.H[3]         // ...............................*........................................................
        mul v8.8H, v8.8H, v0.H[2]               // ................................*.......................................................
        sub v26.8H, v22.8H, v11.8H              // .................................*......................................................
        add v11.8H, v22.8H, v11.8H              // ..................................*.....................................................
        ldr q22, [x0, #320]                     // ...................................*....................................................
        sqrdmulh v16.8H, v26.8H, v1.H[5]        // .....................................*..................................................
        mul v26.8H, v26.8H, v1.H[4]             // ......................................*.................................................
        add v23.8H, v10.8H, v22.8H              // .......................................*................................................
        sub v10.8H, v10.8H, v22.8H              // ........................................*...............................................
        mls v8.8H, v24.8H, v7.H[0]              // .........................................*..............................................
        add v22.8H, v23.8H, v11.8H              // ..........................................*.............................................
        mul v24.8H, v10.8H, v1.H[2]             // ...........................................*............................................
        sqrdmulh v10.8H, v10.8H, v1.H[3]        // ............................................*...........................................
        sub v19.8H, v13.8H, v22.8H              // .............................................*..........................................
        add v18.8H, v13.8H, v22.8H              // ..............................................*.........................................
        sub v11.8H, v23.8H, v11.8H              // ...............................................*........................................
        mls v24.8H, v10.8H, v7.H[0]             // ................................................*.......................................
        mls v26.8H, v16.8H, v7.H[0]             // .................................................*......................................
        sqrdmulh v10.8H, v11.8H, v0.H[5]        // ..................................................*.....................................
        mul v11.8H, v11.8H, v0.H[4]             // ...................................................*....................................
        sqrdmulh v22.8H, v19.8H, v0.H[1]        // ....................................................*...................................
        sub v13.8H, v24.8H, v26.8H              // .....................................................*..................................
        mul v16.8H, v19.8H, v0.H[0]             // ......................................................*.................................
        mls v11.8H, v10.8H, v7.H[0]             // .......................................................*................................
        sqrdmulh v10.8H, v13.8H, v0.H[5]        // ........................................................*...............................
        mul v13.8H, v13.8H, v0.H[4]             // .........................................................*..............................
        add v24.8H, v24.8H, v26.8H              // ..........................................................*.............................
        sub v26.8H, v2.8H, v11.8H               // ...........................................................*............................
        add v9.8H, v2.8H, v11.8H                // ............................................................*...........................
        add v11.8H, v14.8H, v24.8H              // .............................................................*..........................
        sub v14.8H, v14.8H, v24.8H              // ..............................................................*.........................
        sqrdmulh v2.8H, v26.8H, v0.H[1]         // ...............................................................*........................
        mul v24.8H, v26.8H, v0.H[0]             // ................................................................*.......................
        mls v13.8H, v10.8H, v7.H[0]             // .................................................................*......................
        mls v16.8H, v22.8H, v7.H[0]             // ..................................................................*.....................
        sqrdmulh v10.8H, v14.8H, v0.H[1]        // ...................................................................*....................
        mls v24.8H, v2.8H, v7.H[0]              // ....................................................................*...................
        add v22.8H, v8.8H, v13.8H               // .....................................................................*..................
        str q16, [x0, #256]                     // ......................................................................*.................
        sub v2.8H, v8.8H, v13.8H                // .......................................................................*................
        str q24, [x0, #384]                     // ........................................................................*...............
        mul v13.8H, v14.8H, v0.H[0]             // .........................................................................*..............
        str q22, [x0, #192]                     // ..........................................................................*.............
        sqrdmulh v21.8H, v2.8H, v0.H[1]         // ...........................................................................*............
        ldr q6, [x0, #144]                      // ............................................................................*...........
        ldr q14, [x0, #208]                     // ..............................................................................*.........
        mls v13.8H, v10.8H, v7.H[0]             // ................................................................................*.......
        str q11, [x0, #64]                      // .................................................................................*......
        sub v10.8H, v6.8H, v14.8H               // ..................................................................................*.....
        ldr q11, [x0, #16]                      // ...................................................................................*....
        sqrdmulh v19.8H, v10.8H, v1.H[1]        // .....................................................................................*..
        mul v20.8H, v10.8H, v1.H[0]             // ......................................................................................*.
        ldr q28, [x0, #80]                      // .......................................................................................*

                                                 // ---------------------------------- cycle (expected) ----------------------------------->
                                                 // 0                        25                       50                       75
                                                 // |------------------------|------------------------|------------------------|------------
        // ldr q11, [x0, #0]                     // *.......................................................................................
        // ldr q6, [x0, #128]                    // ....*...................................................................................
        // ldr q14, [x0, #192]                   // ........*...............................................................................
        // sub v3.8H, v6.8H, v14.8H              // ............*...........................................................................
        // sqrdmulh v19.8H, v3.8H, v1.H[1]       // ..................*.....................................................................
        // mul v20.8H, v3.8H, v1.H[0]            // ...................*....................................................................
        // ldr q28, [x0, #64]                    // ..*.....................................................................................
        // mls v20.8H, v19.8H, v7.H[0]           // .......................*................................................................
        // ldr q31, [x0, #448]                   // ..............*.........................................................................
        // sub v22.8H, v11.8H, v28.8H            // ......*.................................................................................
        // ldr q30, [x0, #256]                   // ........................*...............................................................
        // sqrdmulh v8.8H, v22.8H, v0.H[7]       // ..........*.............................................................................
        // mul v3.8H, v22.8H, v0.H[6]            // ...........*............................................................................
        // add v10.8H, v11.8H, v28.8H            // .......*................................................................................
        // ldr q22, [x0, #320]                   // ...................................*....................................................
        // ldr q4, [x0, #384]                    // .............................*..........................................................
        // sub v23.8H, v30.8H, v22.8H            // ........................................*...............................................
        // add v27.8H, v30.8H, v22.8H            // .......................................*................................................
        // mls v3.8H, v8.8H, v7.H[0]             // ....................*...................................................................
        // ldr q11, [x0, #16]                    // ...................................................................................*....
        // sub v17.8H, v4.8H, v31.8H             // .................................*......................................................
        // add v2.8H, v6.8H, v14.8H              // .............*..........................................................................
        // mul v19.8H, v23.8H, v1.H[2]           // ...........................................*............................................
        // sub v22.8H, v3.8H, v20.8H             // ...........................*............................................................
        // add v14.8H, v10.8H, v2.8H             // ................*.......................................................................
        // sub v24.8H, v10.8H, v2.8H             // .................*......................................................................
        // sqrdmulh v2.8H, v23.8H, v1.H[3]       // ............................................*...........................................
        // sqrdmulh v30.8H, v22.8H, v0.H[3]      // ...............................*........................................................
        // mul v23.8H, v22.8H, v0.H[2]           // ................................*.......................................................
        // sqrdmulh v15.8H, v17.8H, v1.H[5]      // .....................................*..................................................
        // mls v19.8H, v2.8H, v7.H[0]            // ................................................*.......................................
        // add v2.8H, v4.8H, v31.8H              // ..................................*.....................................................
        // mul v21.8H, v17.8H, v1.H[4]           // ......................................*.................................................
        // sqrdmulh v22.8H, v24.8H, v0.H[3]      // .....................*..................................................................
        // sub v26.8H, v27.8H, v2.8H             // ...............................................*........................................
        // add v8.8H, v27.8H, v2.8H              // ..........................................*.............................................
        // mul v28.8H, v24.8H, v0.H[2]           // ......................*.................................................................
        // sqrdmulh v10.8H, v26.8H, v0.H[5]      // ..................................................*.....................................
        // mul v31.8H, v26.8H, v0.H[4]           // ...................................................*....................................
        // mls v21.8H, v15.8H, v7.H[0]           // .................................................*......................................
        // mls v28.8H, v22.8H, v7.H[0]           // ..........................*.............................................................
        // sub v17.8H, v14.8H, v8.8H             // .............................................*..........................................
        // mls v31.8H, v10.8H, v7.H[0]           // .......................................................*................................
        // sub v27.8H, v19.8H, v21.8H            // .....................................................*..................................
        // sqrdmulh v29.8H, v17.8H, v0.H[1]      // ....................................................*...................................
        // mul v10.8H, v17.8H, v0.H[0]           // ......................................................*.................................
        // sub v15.8H, v28.8H, v31.8H            // ...........................................................*............................
        // sqrdmulh v17.8H, v27.8H, v0.H[5]      // ........................................................*...............................
        // mul v25.8H, v27.8H, v0.H[4]           // .........................................................*..............................
        // sqrdmulh v6.8H, v15.8H, v0.H[1]       // ...............................................................*........................
        // mul v27.8H, v15.8H, v0.H[0]           // ................................................................*.......................
        // add v16.8H, v19.8H, v21.8H            // ..........................................................*.............................
        // mls v25.8H, v17.8H, v7.H[0]           // .................................................................*......................
        // mls v23.8H, v30.8H, v7.H[0]           // .........................................*..............................................
        // mls v27.8H, v6.8H, v7.H[0]            // ....................................................................*...................
        // ldr q6, [x0, #144]                    // ............................................................................*...........
        // add v22.8H, v23.8H, v25.8H            // .....................................................................*..................
        // str q27, [x0, #384]                   // ........................................................................*...............
        // add v4.8H, v3.8H, v20.8H              // ............................*...........................................................
        // str q22, [x0, #192]                   // ..........................................................................*.............
        // mls v10.8H, v29.8H, v7.H[0]           // ..................................................................*.....................
        // add v20.8H, v4.8H, v16.8H             // .............................................................*..........................
        // sub v18.8H, v4.8H, v16.8H             // ..............................................................*.........................
        // str q10, [x0, #256]                   // ......................................................................*.................
        // sub v2.8H, v23.8H, v25.8H             // .......................................................................*................
        // sqrdmulh v12.8H, v18.8H, v0.H[1]      // ...................................................................*....................
        // mul v13.8H, v18.8H, v0.H[0]           // .........................................................................*..............
        // add v18.8H, v14.8H, v8.8H             // ..............................................*.........................................
        // ldr q14, [x0, #208]                   // ..............................................................................*.........
        // mls v13.8H, v12.8H, v7.H[0]           // ................................................................................*.......
        // sub v3.8H, v6.8H, v14.8H              // ..................................................................................*.....
        // add v9.8H, v28.8H, v31.8H             // ............................................................*...........................
        // str q20, [x0, #64]                    // .................................................................................*......
        // sqrdmulh v19.8H, v3.8H, v1.H[1]       // .....................................................................................*..
        // mul v20.8H, v3.8H, v1.H[0]            // ......................................................................................*.
        // sqrdmulh v21.8H, v2.8H, v0.H[1]       // ...........................................................................*............
        // ldr q28, [x0, #80]                    // .......................................................................................*

        sub count, count, #2
Lintt_layer123_start:
                                                // Instructions:    76
                                                // Expected cycles: 84
                                                // Expected IPC:    0.90
                                                //
                                                // Cycle bound:     84.0
                                                // IPC bound:       0.90
                                                //
                                                // Wall time:     15.28s
                                                // User time:     15.28s
                                                //
                                                // -------------------------------- cycle (expected) --------------------------------->
                                                // 0                        25                       50                       75
                                                // |------------------------|------------------------|------------------------|--------
        mls v20.8H, v19.8H, v7.H[0]             // *...................................................................................
        ldr q31, [x0, #464]                     // .*..................................................................................
        sub v22.8H, v11.8H, v28.8H              // ...*................................................................................
        ldr q30, [x0, #272]                     // ....*...............................................................................
        sqrdmulh v8.8H, v22.8H, v0.H[7]         // ......*.............................................................................
        mul v3.8H, v22.8H, v0.H[6]              // .......*............................................................................
        mul v5.8H, v2.8H, v0.H[0]               // ........l...........................................................................
        str q13, [x0, #320]                     // .........l..........................................................................
        add v10.8H, v11.8H, v28.8H              // ..........*.........................................................................
        ldr q22, [x0, #336]                     // ...........*........................................................................
        ldr q4, [x0, #400]                      // .............*......................................................................
        sub v23.8H, v30.8H, v22.8H              // ...............*....................................................................
        add v27.8H, v30.8H, v22.8H              // ................*...................................................................
        mls v3.8H, v8.8H, v7.H[0]               // .................*..................................................................
        mls v5.8H, v21.8H, v7.H[0]              // ..................l.................................................................
        ldr q11, [x0, #32]                      // ...................e................................................................
        sub v17.8H, v4.8H, v31.8H               // .....................*..............................................................
        add v2.8H, v6.8H, v14.8H                // ......................*.............................................................
        mul v19.8H, v23.8H, v1.H[2]             // .......................*............................................................
        sub v22.8H, v3.8H, v20.8H               // ........................*...........................................................
        add v14.8H, v10.8H, v2.8H               // .........................*..........................................................
        sub v24.8H, v10.8H, v2.8H               // ..........................*.........................................................
        sqrdmulh v2.8H, v23.8H, v1.H[3]         // ...........................*........................................................
        sqrdmulh v30.8H, v22.8H, v0.H[3]        // ............................*.......................................................
        mul v23.8H, v22.8H, v0.H[2]             // .............................*......................................................
        sqrdmulh v15.8H, v17.8H, v1.H[5]        // ..............................*.....................................................
        mls v19.8H, v2.8H, v7.H[0]              // ...............................*....................................................
        add v2.8H, v4.8H, v31.8H                // ................................*...................................................
        mul v21.8H, v17.8H, v1.H[4]             // .................................*..................................................
        sqrdmulh v22.8H, v24.8H, v0.H[3]        // ..................................*.................................................
        sub v26.8H, v27.8H, v2.8H               // ...................................*................................................
        add v8.8H, v27.8H, v2.8H                // ....................................*...............................................
        mul v28.8H, v24.8H, v0.H[2]             // .....................................*..............................................
        sqrdmulh v10.8H, v26.8H, v0.H[5]        // ......................................*.............................................
        mul v31.8H, v26.8H, v0.H[4]             // .......................................*............................................
        mls v21.8H, v15.8H, v7.H[0]             // ........................................*...........................................
        mls v28.8H, v22.8H, v7.H[0]             // .........................................*..........................................
        sub v17.8H, v14.8H, v8.8H               // ..........................................*.........................................
        mls v31.8H, v10.8H, v7.H[0]             // ...........................................*........................................
        sub v27.8H, v19.8H, v21.8H              // ............................................*.......................................
        sqrdmulh v29.8H, v17.8H, v0.H[1]        // .............................................*......................................
        mul v10.8H, v17.8H, v0.H[0]             // ..............................................*.....................................
        sub v15.8H, v28.8H, v31.8H              // ...............................................*....................................
        sqrdmulh v17.8H, v27.8H, v0.H[5]        // ................................................*...................................
        mul v25.8H, v27.8H, v0.H[4]             // .................................................*..................................
        sqrdmulh v6.8H, v15.8H, v0.H[1]         // ..................................................*.................................
        mul v27.8H, v15.8H, v0.H[0]             // ...................................................*................................
        add v16.8H, v19.8H, v21.8H              // ....................................................*...............................
        mls v25.8H, v17.8H, v7.H[0]             // .....................................................*..............................
        mls v23.8H, v30.8H, v7.H[0]             // ......................................................*.............................
        mls v27.8H, v6.8H, v7.H[0]              // .......................................................*............................
        ldr q6, [x0, #160]                      // ........................................................e...........................
        add v22.8H, v23.8H, v25.8H              // ..........................................................*.........................
        str q27, [x0, #400]                     // ...........................................................*........................
        add v4.8H, v3.8H, v20.8H                // ............................................................*.......................
        str q22, [x0, #208]                     // .............................................................*......................
        mls v10.8H, v29.8H, v7.H[0]             // ..............................................................*.....................
        str q5, [x0, #448]                      // ...............................................................l....................
        add v20.8H, v4.8H, v16.8H               // ................................................................*...................
        str q18, [x0], #(16)                    // .................................................................l..................
        sub v18.8H, v4.8H, v16.8H               // ..................................................................*.................
        str q10, [x0, #256]                     // ...................................................................*................
        sub v2.8H, v23.8H, v25.8H               // ....................................................................*...............
        sqrdmulh v12.8H, v18.8H, v0.H[1]        // .....................................................................*..............
        mul v13.8H, v18.8H, v0.H[0]             // ......................................................................*.............
        add v18.8H, v14.8H, v8.8H               // .......................................................................*............
        ldr q14, [x0, #208]                     // ........................................................................e...........
        mls v13.8H, v12.8H, v7.H[0]             // ..........................................................................*.........
        str q9, [x0, #112]                      // ...........................................................................l........
        sub v3.8H, v6.8H, v14.8H                // ............................................................................e.......
        add v9.8H, v28.8H, v31.8H               // .............................................................................*......
        str q20, [x0, #64]                      // ..............................................................................*.....
        sqrdmulh v19.8H, v3.8H, v1.H[1]         // ...............................................................................e....
        mul v20.8H, v3.8H, v1.H[0]              // ................................................................................e...
        sqrdmulh v21.8H, v2.8H, v0.H[1]         // .................................................................................*..
        ldr q28, [x0, #80]                      // ..................................................................................e.

                                                      // ------------------------------------------------------------------------------------------------------- cycle (expected) ------------------------------------------------------------------------------------------------------->
                                                      // 0                        25                       50                       75                       100                      125                      150                      175                      200
                                                      // |------------------------|------------------------|------------------------|------------------------|------------------------|------------------------|------------------------|------------------------|------------------------
        // ldr q8, [x0, #0]                           // e................................................................'..................~................................................................'..................~........................................................
        // ldr q9, [x0, #(1*(512/8))]                 // ...............................................................e.'.................................................................................~.'...........................................................................
        // ldr q10, [x0, #(2*(512/8))]                // .....................................e...........................'.......................................................~...........................'.......................................................~...................
        // ldr q11, [x0, #(3*(512/8))]                // .....................................................e...........'.......................................................................~...........'.......................................................................~...
        // ldr q12, [x0, #(4*(512/8))]                // .................................................................'...*...............................................................................'...~.......................................................................
        // ldr q13, [x0, #(5*(512/8))]                // .................................................................'..........*........................................................................'..........~................................................................
        // ldr q14, [x0, #(6*(512/8))]                // .................................................................'............*......................................................................'............~..............................................................
        // ldr q15, [x0, #(7*(512/8))]                // .................................................................'*..................................................................................'~..........................................................................
        // sub v24.8h,   v8.8h, v9.8h                 // .................................................................'..*................................................................................'..~........................................................................
        // add v8.8h, v8.8h, v9.8h                    // .................................................................'.........*.........................................................................'.........~.................................................................
        // sqrdmulh v27.8h,      v24.8h, v0.h[7]      // .................................................................'.....*.............................................................................'.....~.....................................................................
        // mul      v9.8h, v24.8h, v0.h[6]            // .................................................................'......*............................................................................'......~....................................................................
        // mls      v9.8h, v27.8h,      v7.h[0]       // .................................................................'................*..................................................................'................~..........................................................
        // sub v24.8h,   v10.8h, v11.8h               // .........................................................e.......'...........................................................................~.......'...........................................................................
        // add v10.8h, v10.8h, v11.8h                 // ...~.............................................................'.....................*.............................................................'.....................~.....................................................
        // sqrdmulh v27.8h,      v24.8h, v1.h[1]      // ............................................................e....'..............................................................................~....'...........................................................................
        // mul      v11.8h, v24.8h, v1.h[0]           // .............................................................e...'...............................................................................~...'...........................................................................
        // mls      v11.8h, v27.8h,      v7.h[0]      // .................................................................*...................................................................................~...........................................................................
        // sub v24.8h,   v12.8h, v13.8h               // .................................................................'..............*....................................................................'..............~............................................................
        // add v12.8h, v12.8h, v13.8h                 // .................................................................'...............*...................................................................'...............~...........................................................
        // sqrdmulh v27.8h,      v24.8h, v1.h[3]      // ........~........................................................'..........................*........................................................'..........................~................................................
        // mul      v13.8h, v24.8h, v1.h[2]           // ....~............................................................'......................*............................................................'......................~....................................................
        // mls      v13.8h, v27.8h,      v7.h[0]      // ............~....................................................'..............................*....................................................'..............................~............................................
        // sub v24.8h,   v14.8h, v15.8h               // ..~..............................................................'....................*..............................................................'....................~......................................................
        // add v14.8h, v14.8h, v15.8h                 // .............~...................................................'...............................*...................................................'...............................~...........................................
        // sqrdmulh v27.8h,      v24.8h, v1.h[5]      // ...........~.....................................................'.............................*.....................................................'.............................~.............................................
        // mul      v15.8h, v24.8h, v1.h[4]           // ..............~..................................................'................................*..................................................'................................~..........................................
        // mls      v15.8h, v27.8h,      v7.h[0]      // .....................~...........................................'.......................................*...........................................'.......................................~...................................
        // sub v24.8h,   v8.8h, v10.8h                // .......~.........................................................'.........................*.........................................................'.........................~.................................................
        // add v8.8h, v8.8h, v10.8h                   // ......~..........................................................'........................*..........................................................'........................~..................................................
        // sqrdmulh v27.8h,      v24.8h, v0.h[3]      // ...............~.................................................'.................................*.................................................'.................................~.........................................
        // mul      v10.8h, v24.8h, v0.h[2]           // ..................~..............................................'....................................*..............................................'....................................~......................................
        // mls      v10.8h, v27.8h,      v7.h[0]      // ......................~..........................................'........................................*..........................................'........................................~..................................
        // sub v24.8h,   v9.8h, v11.8h                // .....~...........................................................'.......................*...........................................................'.......................~...................................................
        // add v9.8h, v9.8h, v11.8h                   // .........................................~.......................'...........................................................*.......................'...........................................................~...............
        // sqrdmulh v27.8h,      v24.8h, v0.h[3]      // .........~.......................................................'...........................*.......................................................'...........................~...............................................
        // mul      v11.8h, v24.8h, v0.h[2]           // ..........~......................................................'............................*......................................................'............................~..............................................
        // mls      v11.8h, v27.8h,      v7.h[0]      // ...................................~.............................'.....................................................*.............................'.....................................................~.....................
        // sub v24.8h,   v12.8h, v14.8h               // ................~................................................'..................................*................................................'..................................~........................................
        // add v12.8h, v12.8h, v14.8h                 // .................~...............................................'...................................*...............................................'...................................~.......................................
        // sqrdmulh v27.8h,      v24.8h, v0.h[5]      // ...................~.............................................'.....................................*.............................................'.....................................~.....................................
        // mul      v14.8h, v24.8h, v0.h[4]           // ....................~............................................'......................................*............................................'......................................~....................................
        // mls      v14.8h, v27.8h,      v7.h[0]      // ........................~........................................'..........................................*........................................'..........................................~................................
        // sub v24.8h,   v13.8h, v15.8h               // .........................~.......................................'...........................................*.......................................'...........................................~...............................
        // add v13.8h, v13.8h, v15.8h                 // .................................~...............................'...................................................*...............................'...................................................~.......................
        // sqrdmulh v27.8h,      v24.8h, v0.h[5]      // .............................~...................................'...............................................*...................................'...............................................~...........................
        // mul      v15.8h, v24.8h, v0.h[4]           // ..............................~..................................'................................................*..................................'................................................~..........................
        // mls      v15.8h, v27.8h,      v7.h[0]      // ..................................~..............................'....................................................*..............................'....................................................~......................
        // sub v24.8h,   v8.8h, v12.8h                // .......................~.........................................'.........................................*.........................................'.........................................~.................................
        // add v8.8h, v8.8h, v12.8h                   // ....................................................~............'......................................................................*............'......................................................................~....
        // sqrdmulh v27.8h,      v24.8h, v0.h[1]      // ..........................~......................................'............................................*......................................'............................................~..............................
        // mul      v12.8h, v24.8h, v0.h[0]           // ...........................~.....................................'.............................................*.....................................'.............................................~.............................
        // mls      v12.8h, v27.8h,      v7.h[0]      // ...........................................~.....................'.............................................................*.....................'.............................................................~.............
        // sub v24.8h,   v9.8h, v13.8h                // ...............................................~.................'.................................................................*.................'.................................................................~.........
        // add v9.8h, v9.8h, v13.8h                   // .............................................~...................'...............................................................*...................'...............................................................~...........
        // sqrdmulh v27.8h,      v24.8h, v0.h[1]      // ..................................................~..............'....................................................................*..............'....................................................................~......
        // mul      v13.8h, v24.8h, v0.h[0]           // ...................................................~.............'.....................................................................*.............'.....................................................................~.....
        // mls      v13.8h, v27.8h,      v7.h[0]      // .......................................................~.........'.........................................................................*.........'.........................................................................~.
        // sub v24.8h,   v10.8h, v14.8h               // ............................~....................................'..............................................*....................................'..............................................~............................
        // add v10.8h, v10.8h, v14.8h                 // ..........................................................~......'............................................................................*......'...........................................................................
        // sqrdmulh v27.8h,      v24.8h, v0.h[1]      // ...............................~.................................'.................................................*.................................'.................................................~.........................
        // mul      v14.8h, v24.8h, v0.h[0]           // ................................~................................'..................................................*................................'..................................................~........................
        // mls      v14.8h, v27.8h,      v7.h[0]      // ....................................~............................'......................................................*............................'......................................................~....................
        // sub v24.8h,   v11.8h, v15.8h               // .................................................~...............'...................................................................*...............'...................................................................~.......
        // add v11.8h, v11.8h, v15.8h                 // .......................................~.........................'.........................................................*.........................'.........................................................~.................
        // sqrdmulh v27.8h,      v24.8h, v0.h[1]      // ..............................................................~..'................................................................................*..'...........................................................................
        // mul      v15.8h, v24.8h, v0.h[0]           // .................................................................'.......~...........................................................................'.......l...................................................................
        // mls      v15.8h, v27.8h,      v7.h[0]      // .................................................................'.................~.................................................................'.................l.........................................................
        // str q12, [x0, #(4*(512/8))]                // ................................................~................'..................................................................*................'..................................................................~........
        // str q13, [x0, #(5*(512/8))]                // .................................................................'........~..........................................................................'........l..................................................................
        // str q14, [x0, #(6*(512/8))]                // ........................................~........................'..........................................................*........................'..........................................................~................
        // str q15, [x0, #(7*(512/8))]                // ............................................~....................'..............................................................~....................'..............................................................l............
        // str q8, [x0], #(16)                        // ..............................................~..................'................................................................~..................'................................................................l..........
        // str q9, [x0, #(-16 + 1*(512/8))]           // ...........................................................~.....'.............................................................................*.....'...........................................................................
        // str q10, [x0, #(-16 + 2*(512/8))]          // ........................................................~........'..........................................................................~........'..........................................................................l
        // str q11, [x0, #(-16 + 3*(512/8))]          // ..........................................~......................'............................................................*......................'............................................................~..............

        subs count, count, 1
        cbnz count, Lintt_layer123_start
                                                // Instructions:    75
                                                // Expected cycles: 81
                                                // Expected IPC:    0.93
                                                //
                                                // Cycle bound:     81.0
                                                // IPC bound:       0.93
                                                //
                                                // Wall time:     49.44s
                                                // User time:     49.44s
                                                //
                                                // ------------------------------- cycle (expected) ------------------------------->
                                                // 0                        25                       50                       75
                                                // |------------------------|------------------------|------------------------|-----
        mls v20.8H, v19.8H, v7.H[0]             // *................................................................................
        sub v10.8H, v11.8H, v28.8H              // .*...............................................................................
        add v11.8H, v11.8H, v28.8H              // ..*..............................................................................
        mul v2.8H, v2.8H, v0.H[0]               // ...*.............................................................................
        str q13, [x0, #320]                     // ....*............................................................................
        add v25.8H, v6.8H, v14.8H               // .....*...........................................................................
        str q18, [x0], #(16)                    // ......*..........................................................................
        sqrdmulh v17.8H, v10.8H, v0.H[7]        // .......*.........................................................................
        str q9, [x0, #112]                      // ........*........................................................................
        ldr q8, [x0, #448]                      // .........*.......................................................................
        ldr q13, [x0, #256]                     // ...........*.....................................................................
        ldr q26, [x0, #384]                     // .............*...................................................................
        ldr q24, [x0, #320]                     // ...............*.................................................................
        add v15.8H, v26.8H, v8.8H               // .................*...............................................................
        sub v8.8H, v26.8H, v8.8H                // ..................*..............................................................
        sub v12.8H, v13.8H, v24.8H              // ...................*.............................................................
        add v24.8H, v13.8H, v24.8H              // ....................*............................................................
        sqrdmulh v18.8H, v8.8H, v1.H[5]         // .....................*...........................................................
        mul v26.8H, v12.8H, v1.H[2]             // ......................*..........................................................
        mul v8.8H, v8.8H, v1.H[4]               // .......................*.........................................................
        sqrdmulh v16.8H, v12.8H, v1.H[3]        // ........................*........................................................
        mul v10.8H, v10.8H, v0.H[6]             // .........................*.......................................................
        add v22.8H, v11.8H, v25.8H              // ..........................*......................................................
        mls v8.8H, v18.8H, v7.H[0]              // ...........................*.....................................................
        mls v26.8H, v16.8H, v7.H[0]             // ............................*....................................................
        mls v10.8H, v17.8H, v7.H[0]             // .............................*...................................................
        add v23.8H, v24.8H, v15.8H              // ..............................*..................................................
        sub v11.8H, v11.8H, v25.8H              // ...............................*.................................................
        sub v3.8H, v26.8H, v8.8H                // ................................*................................................
        sub v14.8H, v10.8H, v20.8H              // .................................*...............................................
        sub v19.8H, v22.8H, v23.8H              // ..................................*..............................................
        mul v18.8H, v3.8H, v0.H[4]              // ...................................*.............................................
        sqrdmulh v17.8H, v14.8H, v0.H[3]        // ....................................*............................................
        mul v14.8H, v14.8H, v0.H[2]             // .....................................*...........................................
        sqrdmulh v3.8H, v3.8H, v0.H[5]          // ......................................*..........................................
        sub v16.8H, v24.8H, v15.8H              // .......................................*.........................................
        mls v2.8H, v21.8H, v7.H[0]              // ........................................*........................................
        mls v14.8H, v17.8H, v7.H[0]             // .........................................*.......................................
        mls v18.8H, v3.8H, v7.H[0]              // ..........................................*......................................
        sqrdmulh v31.8H, v16.8H, v0.H[5]        // ...........................................*.....................................
        str q2, [x0, #432]                      // ............................................*....................................
        mul v13.8H, v16.8H, v0.H[4]             // .............................................*...................................
        add v24.8H, v14.8H, v18.8H              // ..............................................*..................................
        sqrdmulh v2.8H, v11.8H, v0.H[3]         // ...............................................*.................................
        mul v21.8H, v11.8H, v0.H[2]             // ................................................*................................
        mls v13.8H, v31.8H, v7.H[0]             // .................................................*...............................
        add v16.8H, v26.8H, v8.8H               // ..................................................*..............................
        add v28.8H, v10.8H, v20.8H              // ...................................................*.............................
        mls v21.8H, v2.8H, v7.H[0]              // ....................................................*............................
        sub v14.8H, v14.8H, v18.8H              // .....................................................*...........................
        add v2.8H, v28.8H, v16.8H               // ......................................................*..........................
        sub v10.8H, v28.8H, v16.8H              // .......................................................*.........................
        sub v16.8H, v21.8H, v13.8H              // ........................................................*........................
        sqrdmulh v27.8H, v19.8H, v0.H[1]        // .........................................................*.......................
        mul v26.8H, v19.8H, v0.H[0]             // ..........................................................*......................
        sqrdmulh v19.8H, v16.8H, v0.H[1]        // ...........................................................*.....................
        mul v28.8H, v16.8H, v0.H[0]             // ............................................................*....................
        sqrdmulh v8.8H, v14.8H, v0.H[1]         // .............................................................*...................
        mls v26.8H, v27.8H, v7.H[0]             // ..............................................................*..................
        mul v14.8H, v14.8H, v0.H[0]             // ...............................................................*.................
        mls v28.8H, v19.8H, v7.H[0]             // ................................................................*................
        sqrdmulh v20.8H, v10.8H, v0.H[1]        // .................................................................*...............
        str q26, [x0, #256]                     // ..................................................................*..............
        mul v10.8H, v10.8H, v0.H[0]             // ...................................................................*.............
        str q28, [x0, #384]                     // ....................................................................*............
        add v22.8H, v22.8H, v23.8H              // .....................................................................*...........
        str q24, [x0, #192]                     // ......................................................................*..........
        mls v10.8H, v20.8H, v7.H[0]             // .......................................................................*.........
        str q2, [x0, #64]                       // ........................................................................*........
        mls v14.8H, v8.8H, v7.H[0]              // .........................................................................*.......
        str q22, [x0], #(16)                    // ..........................................................................*......
        add v11.8H, v21.8H, v13.8H              // ...........................................................................*.....
        str q10, [x0, #304]                     // ............................................................................*....
        str q11, [x0, #112]                     // ..............................................................................*..
        str q14, [x0, #432]                     // ................................................................................*

                                                 // ------------------------------- cycle (expected) ------------------------------->
                                                 // 0                        25                       50                       75
                                                 // |------------------------|------------------------|------------------------|-----
        // mls v20.8H, v19.8H, v7.H[0]           // *................................................................................
        // ldr q31, [x0, #464]                   // .........*.......................................................................
        // sub v22.8H, v11.8H, v28.8H            // .*...............................................................................
        // ldr q30, [x0, #272]                   // ...........*.....................................................................
        // sqrdmulh v8.8H, v22.8H, v0.H[7]       // .......*.........................................................................
        // mul v3.8H, v22.8H, v0.H[6]            // .........................*.......................................................
        // mul v5.8H, v2.8H, v0.H[0]             // ...*.............................................................................
        // str q13, [x0, #320]                   // ....*............................................................................
        // add v10.8H, v11.8H, v28.8H            // ..*..............................................................................
        // ldr q22, [x0, #336]                   // ...............*.................................................................
        // ldr q4, [x0, #400]                    // .............*...................................................................
        // sub v23.8H, v30.8H, v22.8H            // ...................*.............................................................
        // add v27.8H, v30.8H, v22.8H            // ....................*............................................................
        // mls v3.8H, v8.8H, v7.H[0]             // .............................*...................................................
        // mls v5.8H, v21.8H, v7.H[0]            // ........................................*........................................
        // sub v17.8H, v4.8H, v31.8H             // ..................*..............................................................
        // add v2.8H, v6.8H, v14.8H              // .....*...........................................................................
        // mul v19.8H, v23.8H, v1.H[2]           // ......................*..........................................................
        // sub v22.8H, v3.8H, v20.8H             // .................................*...............................................
        // add v14.8H, v10.8H, v2.8H             // ..........................*......................................................
        // sub v24.8H, v10.8H, v2.8H             // ...............................*.................................................
        // sqrdmulh v2.8H, v23.8H, v1.H[3]       // ........................*........................................................
        // sqrdmulh v30.8H, v22.8H, v0.H[3]      // ....................................*............................................
        // mul v23.8H, v22.8H, v0.H[2]           // .....................................*...........................................
        // sqrdmulh v15.8H, v17.8H, v1.H[5]      // .....................*...........................................................
        // mls v19.8H, v2.8H, v7.H[0]            // ............................*....................................................
        // add v2.8H, v4.8H, v31.8H              // .................*...............................................................
        // mul v21.8H, v17.8H, v1.H[4]           // .......................*.........................................................
        // sqrdmulh v22.8H, v24.8H, v0.H[3]      // ...............................................*.................................
        // sub v26.8H, v27.8H, v2.8H             // .......................................*.........................................
        // add v8.8H, v27.8H, v2.8H              // ..............................*..................................................
        // mul v28.8H, v24.8H, v0.H[2]           // ................................................*................................
        // sqrdmulh v10.8H, v26.8H, v0.H[5]      // ...........................................*.....................................
        // mul v31.8H, v26.8H, v0.H[4]           // .............................................*...................................
        // mls v21.8H, v15.8H, v7.H[0]           // ...........................*.....................................................
        // mls v28.8H, v22.8H, v7.H[0]           // ....................................................*............................
        // sub v17.8H, v14.8H, v8.8H             // ..................................*..............................................
        // mls v31.8H, v10.8H, v7.H[0]           // .................................................*...............................
        // sub v27.8H, v19.8H, v21.8H            // ................................*................................................
        // sqrdmulh v29.8H, v17.8H, v0.H[1]      // .........................................................*.......................
        // mul v10.8H, v17.8H, v0.H[0]           // ..........................................................*......................
        // sub v15.8H, v28.8H, v31.8H            // ........................................................*........................
        // sqrdmulh v17.8H, v27.8H, v0.H[5]      // ......................................*..........................................
        // mul v25.8H, v27.8H, v0.H[4]           // ...................................*.............................................
        // sqrdmulh v6.8H, v15.8H, v0.H[1]       // ...........................................................*.....................
        // mul v27.8H, v15.8H, v0.H[0]           // ............................................................*....................
        // add v16.8H, v19.8H, v21.8H            // ..................................................*..............................
        // mls v25.8H, v17.8H, v7.H[0]           // ..........................................*......................................
        // mls v23.8H, v30.8H, v7.H[0]           // .........................................*.......................................
        // mls v27.8H, v6.8H, v7.H[0]            // ................................................................*................
        // add v22.8H, v23.8H, v25.8H            // ..............................................*..................................
        // str q27, [x0, #400]                   // ....................................................................*............
        // add v4.8H, v3.8H, v20.8H              // ...................................................*.............................
        // str q22, [x0, #208]                   // ......................................................................*..........
        // mls v10.8H, v29.8H, v7.H[0]           // ..............................................................*..................
        // str q5, [x0, #448]                    // ............................................*....................................
        // add v20.8H, v4.8H, v16.8H             // ......................................................*..........................
        // str q18, [x0], #(16)                  // ......*..........................................................................
        // sub v18.8H, v4.8H, v16.8H             // .......................................................*.........................
        // str q10, [x0, #256]                   // ..................................................................*..............
        // sub v2.8H, v23.8H, v25.8H             // .....................................................*...........................
        // sqrdmulh v12.8H, v18.8H, v0.H[1]      // .................................................................*...............
        // mul v13.8H, v18.8H, v0.H[0]           // ...................................................................*.............
        // add v18.8H, v14.8H, v8.8H             // .....................................................................*...........
        // mls v13.8H, v12.8H, v7.H[0]           // .......................................................................*.........
        // str q9, [x0, #112]                    // ........*........................................................................
        // add v9.8H, v28.8H, v31.8H             // ...........................................................................*.....
        // str q20, [x0, #64]                    // ........................................................................*........
        // sqrdmulh v21.8H, v2.8H, v0.H[1]       // .............................................................*...................
        // mul v5.8H, v2.8H, v0.H[0]             // ...............................................................*.................
        // str q13, [x0, #320]                   // ............................................................................*....
        // mls v5.8H, v21.8H, v7.H[0]            // .........................................................................*.......
        // str q5, [x0, #448]                    // ................................................................................*
        // str q18, [x0], #(16)                  // ..........................................................................*......
        // str q9, [x0, #112]                    // ..............................................................................*..


        pop_stack
        ret
        .cfi_endproc

/****************** REGISTER DEALLOCATIONS *******************/
    .unreq in
    .unreq r12345_ptr
    .unreq r67_ptr
    .unreq inp
    .unreq count
    .unreq wtmp
    .unreq data0
    .unreq data1
    .unreq data2
    .unreq data3
    .unreq data4
    .unreq data5
    .unreq data6
    .unreq data7
    .unreq q_data0
    .unreq q_data1
    .unreq q_data2
    .unreq q_data3
    .unreq q_data4
    .unreq q_data5
    .unreq q_data6
    .unreq q_data7
    .unreq root0
    .unreq root1
    .unreq root2
    .unreq root0_tw
    .unreq root1_tw
    .unreq root2_tw
    .unreq consts
    .unreq q_consts
    .unreq q_root0
    .unreq q_root1
    .unreq q_root2
    .unreq q_root0_tw
    .unreq q_root1_tw
    .unreq q_root2_tw
    .unreq tmp
    .unreq t0
    .unreq t1
    .unreq t2
    .unreq t3
    .unreq ninv
    .unreq ninv_tw

/* simpasm: footer-start */
#endif /* MLK_ARITH_BACKEND_AARCH64 && !MLK_CONFIG_MULTILEVEL_NO_SHARED */
