/*
 * Copyright (c) The mlkem-native project authors
 * SPDX-License-Identifier: Apache-2.0 OR ISC OR MIT
 */

#include "../../../../common.h"
#include "../../../../verify.h"

#if defined(MLK_FIPS202_ARMV81M_NEED_X4) && \
    !defined(MLK_CONFIG_MULTILEVEL_NO_SHARED)

#include "fips202_native_armv81m.h"


/*
 * Keccak-f1600 x4 permutation (on bit-interleaved state)
 * State is expected to already be in bit-interleaved format.
 */
#define mlk_keccak_f1600_x4_native_impl \
  MLK_NAMESPACE(keccak_f1600_x4_native_impl)
int mlk_keccak_f1600_x4_native_impl(uint64_t *state)
{
  MLK_ALIGN uint64_t state_tmp[100];
  mlk_keccak_f1600_x4_mve_asm(state, state_tmp,
                              mlk_keccakf1600_round_constants);
  mlk_zeroize(state_tmp, sizeof(state_tmp));
  return MLK_NATIVE_FUNC_SUCCESS;
}

#else /* MLK_FIPS202_ARMV81M_NEED_X4 && !MLK_CONFIG_MULTILEVEL_NO_SHARED */

MLK_EMPTY_CU(keccak_f1600_x4_mve)

#endif /* !(MLK_FIPS202_ARMV81M_NEED_X4 && !MLK_CONFIG_MULTILEVEL_NO_SHARED) \
        */

/* To facilitate single-compilation-unit (SCU) builds, undefine all macros.
 * Don't modify by hand -- this is auto-generated by scripts/autogen. */
/* Some macros are kept because they are also defined in a header. */
/* Keep: mlk_keccak_f1600_x4_native_impl (mve.h) */
